var AppModels=function(){this.theater=new Theater},Theater=function(){this.screens=[],this.movies=[],this.initScreens=function(){this.screens.push(new ScreeningRoom("Hans Theater A",this)),this.screens.push(new ScreeningRoom("Murray Theater B",this)),this.screens.push(new ScreeningRoom("Joey Theater C",this)),this.screens.push(new ScreeningRoom("Stuart Theater D",this)),this.screens.push(new ScreeningRoom("Christine Theater E",this))},this.initMovieList=function(){this.movies.push(new Movie("The Godfather",1972)),this.movies.push(new Movie("The Great Escape",1963)),this.movies.push(new Movie("Pulp Fiction",1994)),this.movies.push(new Movie("Schindlerâ€™s List",1993)),this.movies.push(new Movie("The Dark Knight",2008)),this.movies.push(new Movie("Goodfellas",1990)),this.movies.push(new Movie("Star Wars",1977)),this.movies.push(new Movie("Casablanca",1942)),this.movies.push(new Movie("Citizen Kane",1941)),this.movies.push(new Movie("Psycho",1960))},this.assignMovies=function(){this.screens[0].movie=this.movies[0],this.screens[1].movie=this.movies[1],this.screens[2].movie=this.movies[2],this.screens[3].movie=this.movies[3],this.screens[4].movie=this.movies[4]},this.initScreens(),this.initMovieList(),this.assignMovies(),this.ticketsSold=function(){for(var e=0,t=0;t<this.screens.length;t++)e+=this.screens[t].ticketsSold();return e},this.simulateDay=function(){for(var e=0;e<this.screens.length;e++)this.screens[e].simulateDay()}},ScreeningRoom=function(e,t){this.name=e,this.theater=t,this.movie=null,this.capacity=100,this.screenings=[],this.screenings.push(new ScreeningTime("2:00 PM",this)),this.screenings.push(new ScreeningTime("4:00 PM",this)),this.screenings.push(new ScreeningTime("6:00 PM",this)),this.screenings.push(new ScreeningTime("8:00 PM",this)),this.ticketsSold=function(){for(var e=0,t=0;t<this.screenings.length;t++)e+=this.screenings[t].ticketsSold;return e},this.simulateDay=function(){for(var e=0;e<this.screenings.length;e++)this.screenings[e].simulateDay()}},ScreeningTime=function(e,t){this.name=e,this.screen=t,this.ticketsSold=0,this.ticketsRemaining=function(){return this.screen.capacity-this.ticketsSold},this.simulateDay=function(){var e=Math.random()*this.screen.capacity;this.ticketsSold=Math.floor(e)}},Movie=function(e,t){this.name=e,this.year=t},AppViews=function(){this.menuView=new MenuView,this.instrView=new InstrView,this.adminPanel=new AdminPanel,this.custsPanel=new CustsPanel,this.reportsPanel=new ReportsPanel,this.panels=[],this.panels.push(this.instrView),this.panels.push(this.adminPanel),this.panels.push(this.custsPanel),this.panels.push(this.reportsPanel)},MenuView=function(){this.elem=document.getElementById("main-menu"),this.btnInstr=document.getElementById("menu-button-instr"),this.btnAdmin=document.getElementById("menu-button-admin"),this.btnCusts=document.getElementById("menu-button-custs"),this.btnReports=document.getElementById("menu-button-reports"),this.btnCusts.disabled=!0,this.btnReports.disabled=!0},InstrView=function(){this.elem=document.getElementById("instr-view")},AdminPanel=function(){this.elem=document.getElementById("admin-panel"),this.selScreen=document.getElementById("admin-select-screen"),this.selCapacity=document.getElementById("admin-select-capacity"),this.selMovie=document.getElementById("admin-select-movie"),this.btnAccept=document.getElementById("admin-button-accept"),this.btnSim=document.getElementById("admin-button-sim")},CustsPanel=function(){this.elem=document.getElementById("custs-panel"),this.selMovie=document.getElementById("custs-select-movie"),this.selTime=document.getElementById("custs-select-time"),this.paraTicketsRem=document.getElementById("custs-tickets-rem"),this.inpTickets=document.getElementById("custs-input-tickets"),this.btnSubmit=document.getElementById("custs-button-submit"),this.btnCancel=document.getElementById("custs-button-cancel"),this.btnSim=document.getElementById("custs-button-sim"),this.clear=function(){this.selMovie.selectedIndex=0,this.selTime.selectedIndex=0,this.inpTickets.value=1,this.selMovie.focus()},this.showTicketsRem=function(e){this.paraTicketsRem.innerHTML="Tickets remaining: "+e}},ReportsPanel=function(e){this.view=e,this.elem=document.getElementById("report-panel"),this.divConsole=document.getElementById("report-console"),this.clearConsole=function(){this.divConsole.innerHTML=""},this.writeConsole=function(e){var t=this.divConsole.innerHTML;this.divConsole.innerHTML=t+e+"<br/>"}},AppCtrls=function(e){this.app=e,this.menuCtrl=new MenuCtrl(e),this.adminCtrl=new AdminCtrl(e),this.custsCtrl=new CustsCtrl(e),this.reportsCtrl=new ReportsCtrl(e)},MenuCtrl=function(e){this.app=e,this.view=e.views.menuView,this.onButtonClicks=function(e){var t=e.target,i=t.ctrl,s=i.app.views;switch(t){case i.view.btnInstr:i.showPanel(s.instrView);break;case i.view.btnAdmin:i.showPanel(s.adminPanel);break;case i.view.btnCusts:i.showPanel(s.custsPanel);break;case i.view.btnReports:i.showPanel(s.reportsPanel)}},this.addHandlers=function(){((((this.view.btnInstr.ctrl=this).view.btnAdmin.ctrl=this).view.btnCusts.ctrl=this).view.btnReports.ctrl=this).view.btnInstr.addEventListener("click",this.onButtonClicks),this.view.btnAdmin.addEventListener("click",this.onButtonClicks),this.view.btnCusts.addEventListener("click",this.onButtonClicks),this.view.btnReports.addEventListener("click",this.onButtonClicks)},this.hidePanels=function(){for(var e=this.app.views.panels,t=0;t<e.length;t++)e[t].elem.classList.remove("panel-visible"),e[t].elem.classList.add("panel-hidden")},this.showPanel=function(e){if(this.hidePanels(),e==this.app.views.custsPanel){var t=this.app.ctrls.custsCtrl;e.clear(t.ticketsRemaining())}e==this.app.views.reportsPanel&&this.app.ctrls.reportsCtrl.showReport();e.elem.classList.remove("panel-hidden"),e.elem.classList.add("panel-visible")},this.addHandlers()},ReportsCtrl=function(h){this.app=h,this.view=h.views.reportsPanel,this.showReport=function(){var e=h.models.theater,t=null,i=null,s=new Date,n="";this.view.clearConsole(),n="Theater-V daily report: "+s.toLocaleString(),this.view.writeConsole(n),this.view.writeConsole("");for(var o=0;o<e.screens.length;o++){n="<b>"+(t=e.screens[o]).name+" - "+t.capacity+" seats</b>",this.view.writeConsole(n),n="<b>"+t.movie.name+" ("+t.movie.year+")</b>",this.view.writeConsole(n);for(var c=0;c<t.screenings.length;c++)n=(i=t.screenings[c]).name+" tickets sold: "+i.ticketsSold,this.view.writeConsole(n);s2="Total tickets: "+t.ticketsSold(),this.view.writeConsole(s2),this.view.writeConsole("")}this.view.writeConsole(""),n="<span class='report-big'>Theater-V daily ticket sales: "+e.ticketsSold()+"</span>",this.view.writeConsole(n),this.view.writeConsole("")}},AdminCtrl=function(e){this.app=e,this.view=e.views.adminPanel,this.onSelChanges=function(e){var t=e.target,i=t.ctrl;switch(t){case i.view.selScreen:i.selectScreen();break;case i.view.selCapacity:i.selectCapacity();break;case i.view.selMovie:i.selectMovie()}},this.onButtonClicks=function(e){var t=e.target,i=t.ctrl;switch(t){case i.view.btnAccept:i.acceptSettings();break;case i.view.btnSim:i.simulateDay()}},this.addHandlers=function(){var e=this.view;e.selScreen.ctrl=this,e.selCapacity.ctrl=this,e.selMovie.ctrl=this,e.btnAccept.ctrl=this,e.btnSim.ctrl=this,e.selScreen.addEventListener("change",this.onSelChanges),e.selCapacity.addEventListener("change",this.onSelChanges),e.selMovie.addEventListener("change",this.onSelChanges),e.btnAccept.addEventListener("click",this.onButtonClicks),e.btnSim.addEventListener("click",this.onButtonClicks)},this.populateDropdowns=function(){for(var e=this.app.models.theater,t=e.screens,i=e.movies,s=this.view.selScreen,n=this.view.selCapacity,o=this.view.selMovie,c=0;c<t.length;c++){var h=t[c].name;s.options[c]=new Option(h,h)}n.options[0]=new Option("60","60"),n.options[1]=new Option("80","80"),n.options[2]=new Option("100","100"),n.options[3]=new Option("120","120"),n.options[4]=new Option("140","140");for(c=0;c<i.length;c++){var a=i[c].name;o.options[c]=new Option(a,a)}},this.selectScreen=function(){var e=this.view.selScreen,t=this.view.selCapacity,i=this.view.selMovie,s=this.app.models.theater.screens[e.selectedIndex];t.value=s.capacity,i.value=s.movie.name},this.selectCapacity=function(){var e=this.view.selScreen,t=this.view.selCapacity;this.app.models.theater.screens[e.selectedIndex].capacity=t.value},this.selectMovie=function(){var e=this.view.selScreen,t=this.view.selMovie,i=this.app.models.theater,s=i.screens[e.selectedIndex],n=i.movies[t.selectedIndex];s.movie=n},this.acceptSettings=function(){var e=this.view.btnAccept,t=this.view.btnSim,i=this.app.views.menuView.btnCusts,s=this.app.views.menuView.btnReports;e.classList.add("button-disabled"),e.disabled=!0,this.view.selCapacity.disabled=!0,this.view.selMovie.disabled=!0,t.disabled=!1,t.classList.remove("button-disabled"),i.disabled=!1,i.classList.remove("button-disabled"),s.disabled=!1,s.classList.remove("button-disabled"),this.app.ctrls.custsCtrl.populateDropdowns()},this.simulateDay=function(){var e=this.app.models.theater,t=this.app.ctrls.menuCtrl,i=this.app.views.reportsPanel;e.simulateDay(),t.showPanel(i)},this.addHandlers(),this.populateDropdowns(),this.selectScreen()},CustsCtrl=function(e){this.app=e,this.view=e.views.custsPanel,this.ticketsRemaining=function(){return 11},this.onSelChanges=function(e){var t=e.target,i=t.ctrl;switch(t){case i.view.selMovie:i.selectMovie();break;case i.view.selTime:i.selectTime()}},this.onButtonClicks=function(e){var t=e.target,i=t.ctrl;switch(t){case i.view.btnSubmit:i.submitOrder();break;case i.view.btnCancel:i.cancelOrder();break;case i.view.btnSim:i.simulateOrder()}},this.addHandlers=function(){(((((this.view.selMovie.ctrl=this).view.selTime.ctrl=this).view.btnSubmit.ctrl=this).view.btnCancel.ctrl=this).view.btnSim.ctrl=this).view.selMovie.addEventListener("change",this.onSelChanges),this.view.selTime.addEventListener("change",this.onSelChanges),this.view.btnSubmit.addEventListener("click",this.onButtonClicks),this.view.btnCancel.addEventListener("click",this.onButtonClicks),this.view.btnSim.addEventListener("click",this.onButtonClicks)},this.populateDropdowns=function(){for(var e=this.app.models.theater.screens,t=e[0].screenings,i=this.view.selMovie,s=this.view.selTime,n=["A","B","C","D","E"],o=0;o<e.length;o++){var c=e[o].movie.name,h=n[o]+" - "+c;i.options[o]=new Option(h,h)}for(o=0;o<t.length;o++){var a=t[o].name;s.options[o]=new Option(a,a)}this.selectMovie()},this.selectMovie=function(){this.view.selTime.selectedIndex=0,this.selectTime()},this.selectTime=function(){var e=this.view.selMovie,t=this.view.selTime,i=this.app.models.theater.screens[e.selectedIndex].screenings[t.selectedIndex];this.view.showTicketsRem(i.ticketsRemaining())},this.submitOrder=function(){var e=this.view.selMovie,t=this.view.selTime,i=this.app.models.theater.screens[e.selectedIndex],s=i.screenings[t.selectedIndex],n=i.movie.name,o=s.ticketsRemaining(),c=this.view.inpTickets.value,h="";if(this.validateInput(c))if(this.view.inpTickets.value<1)this.view.inpTickets.value=1;else{if(o<c)return h="We're sorry - ",2<=o&&(h+="only "+o+" tickets are remaining for that time slot."),1==o&&(h+="there is only one ticket remaining for that time slot."),0==o&&(h+="there are no more tickets remaining for that time slot."),alert(h),void(this.view.inpTickets.value=1);s.ticketsSold+=parseInt(c),alert("Thank you for your order of "+c+" tickets.\nEnjoy your movie "+n+".\n\n"),this.view.clear(),this.selectMovie()}else this.view.inpTickets.value=1},this.validateInput=function(e){return e=parseInt(e),!isNaN(e)},this.orderAmountOK=function(){return!(theater.screens[selMovie.selectedIndex].screenings[selTime.selectedIndex].ticketsRemaining()<this.view.inpTickets.value)},this.cancelOrder=function(){this.view.clear(),this.selectMovie()},this.simulateOrder=function(){var e,t,i=this.view.selMovie,s=this.view.selTime,n=this.app.models.theater,o=null,c=Math.floor(Math.random()*i.options.length),h=Math.floor(Math.random()*s.options.length);i.selectedIndex=c,s.selectedIndex=h,0!=(t=(o=n.screens[i.selectedIndex].screenings[s.selectedIndex]).ticketsRemaining())&&(e=Math.floor(Math.random()*t)+1,this.view.inpTickets.value=e,o.ticketsSold+=e,this.view.showTicketsRem(o.ticketsRemaining()))},this.addHandlers()},TheaterApp=function(){this.models=new AppModels,this.views=new AppViews,this.ctrls=new AppCtrls(this)},theaterApp=new TheaterApp;